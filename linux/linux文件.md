# 文件



## 基本知识

### 新建文件夹

```bash
mkdir xxx
```

- `-p` 确保目录名称存在，不存在的就建一个。

e.g.

```bash
mkdir -p /opt/settings/
```

### 显示隐藏文件

```bash
ls -la
```

### 复制、移动与删除

####  文件复制命令cp

```bash
cp [-adfilprsu] 源文件(source) 目标位置(destination)
cp [option] source1 source2 source3 ... directory
```

##### option

- `-a` 是指archive的意思，也说是指复制所有的目录。
- `-d` 若源文件为连接文件(link file)，则复制连接文件属性而非文件本身。
- `-f` 强制(force)，若有重复或其它疑问时，不会询问用户，而强制复制。
- `-i` 若目标文件(destination)已存在，在覆盖时会先询问是否真的操作。
- `-l` 建立硬连接(hard link)的连接文件，而非复制文件本身。
- `-p` 与文件的属性一起复制，而非使用默认属性。
- `-r` 递归复制，用于目录的复制操作。
- `-s` 复制成符号连接文件(symbolic link)，即“快捷方式”文件。
- `-u` 若目标文件比源文件旧，更新目标文件。

#### 文件移动命令mv

```bash
mv [-fiv] source destination
```

##### option

- `-f` force，强制直接移动而不询问。
- `-i` 若目标文件(destination)已经存在，就会询问是否覆盖。
- `-u` 若目标文件已经存在，且源文件比较新，才会更新。

####文件删除命令rm

```bash
rm [fir] 文件或目录
```

##### option

- `-f` 强制删除。
- `-i` 交互模式，在删除前询问用户是否操作。
- `-r` 递归删除，常用在目录的删除。

### 打包

```bash
tar -cvf <filename>.tar <filename>
```

此命令只是打包，不是压缩。

#### option

- `-c` 或 `--create` 建立新的备份文件。

- `-r` 或 `--append` 新增文件到已存在的备份文件的结尾部分。

- `-v` 显示指令执行过程。
- `-f <备份文件>` 或 `--file=<备份文件>` 指定备份文件。
- `-z` 或 `--gzip` 或 `--ungzip` 通过gzip指令处理备份文件。

### 解压

```bash
tar -zxvf ./xxx -C /xxx
```

tar是用来建立，还原备份文件的工具程序，它可以加入，解开备份文件内的文件。

- `-z` 通过gzip指令处理备份文件。
- `-x` 从备份文件中还原文件。

- `-v` 显示指令执行过程。

- `-f` 指定备份文件。

- `-C` <目的目录> 切换到指定目录。

### tail 动态实时展示文件的变化过程

tail命令可以动态实时展示文件的变化过程。

**example**: 

```bash
tail -f error.2019-12-28.log
```

```bash
tail -f info.2019-12-28.log
```

### 查看磁盘剩余空间

```bash
df -hl
```

### 查看当前文件夹大小

```bash
du -sh
```

###  列出当前文件夹下的所有文件夹及其大小，并按照文件夹大小排序

```bash
du -sh * | sort -n
```

### 文件描述符

![img](https://image-hosting.jellyfishmix.com/20200718110444.jpg)

#### 文件描述符基本知识

> 文件描述符是与文件输入、输出关联的整数。它们用来跟踪已打开的文件。最常见的文件描述符是stidin、stdout、和stderr。我们可以将某个文件描述符的内容重定向到另外一个文件描述符中。 -- 《linux shell脚本攻略》


文件描述符我们常见的就是系统预留的0，1和2这三个，他们的意义分别有如下对应关系：

- 0 -- stdin（标准输入）
- 1 -- stdout （标准输出）
- 2 -- stderr （标准错误）

其中，shell编程里经常用到的就是描述符1，和描述符2。这样下面我们来举两个栗子，就知道神马是1和2了：

1. stdout
   假设：在当前目录下我们“有且只有”一个文件名为 123.txt 的文本文件。这个时候我们运行下面的命令【ls 123.txt】:

   ![img](https://image-hosting.jellyfishmix.com/20200718110630.jpg)

2. stderr

   按照上面同样的假设，我们运行另外一跳命令【ls abc.txt】：

   ![img](https://image-hosting.jellyfishmix.com/20200718110701.jpg)

   我们就会获得一个标准错误stderr的输出结果“ls：无法访问abc.txt：没有那个文件或目录”。

   有同学应该会觉得，这两个事例好像跟1和2这两个阿拉伯数字好像没有关系。这个就要结合第二个知识点“重定向操作”来理解了。

#### 重定向操作

重定向操作，其实就是通过在shell命令后面追加一个重定向操作符号，将shell命令对应的文件描述符输出的文本信息重新输入到另外一个指定文件的操作。

重定向操作符号有两个>和>>。尽管这两个操作符都可以将重定向到文件，但是前者会先清空文件，再写入内容；后者会将内容追加到现有文件的尾部。（对了，重定向的操作制定的文件如果原来不存在的话，重定向的操作会主动创建这个文件名的文件的）

- 重定向标准输出stdout

  ![img](https://image-hosting.jellyfishmix.com/20200718110935.jpg)

  如上图所示，对比没有添加重定向的操作，ls命令在使用之后并没有将字符“123.txt”这个字符串打印到屏幕上。在紧接着的cat操作之后，我们可以看到本来应该输出字符串被记录在了stdout.txt这个文件里面了。

  

  其实，对于标准输出的重定向操作，>等同于1>。上面栗子执行命令 `ls 123.txt > stdout.txt` 得到的效果也是一样的。

- 重定向标准错误stderr

  ![img](https://image-hosting.jellyfishmix.com/20200718111023.jpg)

  如上图所示，文件描述符2，标准错误的重定向也是同样的原理被记录在了文件stderr.txt这个文件里面了。

  

  描述符的重定向还有下面的几种用法：
  你可以将stderr单独定向到一个文件，将stdout重定向到另一个文件：

  ```bash
  cmd 2>stderr.txt 1>stdout.txt
  ```

  也可以利用下面的方法，将stderr转换成stdout，使得stderr和stdout都被重新定向到同一个文件中：

  ```bash
  cmd> output.txt 2>&1
  ```

  或者采用这个方法

  ```bash
  # 两个表达式效果一样
  cmd &> output.txt
  cmd >& output.txt
  ```

####linux特殊文件

> /dev/null是一个特殊的设备文件，这个文件接收到的任何数据都会被丢弃。因此，null这个设备通常也被成为位桶（bit bucket）或黑洞。 --  《linux shell脚本攻略》

简单地理解就是，重定向操作给这个/dev/null文件的所有东西都会被丢弃。



## Linux 挂载

1. 提一句Windows下，mount挂载，就是给磁盘分区提供一个盘符（C,D,E,...）。比如插入U盘后系统自动分配给了它I:盘符其实就是挂载，退优盘的时候进行安全弹出，其实就是卸载unmount。

2. Linux下，不像Windows可以有C,D,E,多个目录，Linux只有一个根目录/。在装系统时，我们分配给linux的所有区都在/下的某个位置，比如/home等等。

3. 提问者插入了新硬盘，分了新磁盘区sdb1。它现在还不属于/。

4. 我们虽然可以在一些图形桌面系统里找到他的位置，浏览管理里面的文件，但在命令行却不知怎么访问它的目录，比如无法使用cd或者ls。也无法在编程时指定一个目录对它操作。

5. 这时提问者使用了 mount /dev/sdb1 ~/Share/ ，把新硬盘的区sdb1挂载到工作目录的~/Share/文件夹下，之后访问这个~/Share/文件夹就相当于访问这个硬盘2的sdb1分区了。对/Share/的任何操作，都相当于对sdb1里文件的操作。

6. 所以Linux下，mount挂载的作用，就是将一个设备（通常是存储设备）挂接到一个已存在的目录上。访问这个目录就是访问该存储设备。

7. linux操作系统将所有的设备都看作文件，它将整个计算机的资源都整合成一个大的文件目录。我们要访问存储设备中的文件，必须将文件所在的分区挂载到一个已存在的目录上，然后通过访问这个目录来访问存储设备。挂载就是把设备放在一个目录下，让系统知道怎么管理这个设备里的文件，了解这个存储设备的可读写特性之类的过程。

8. 我们不是有/dev/sdb1 吗，直接对它操作不就行了？这不是它的目录吗？

9. 这不是它的目录。虽然/dev是个目录，但/dev/sdb1不是目录。可以发现ls/dev/sdb1无法执行。/dev/sdb1，是一个类似指针的东西，指向这个分区的原始数据块。mount前，系统并不知道这个数据块哪部分数据代表文件，如何对它们操作。

10. 插入CD，系统其实自动执行了 mount /dev/cdrom /media/cdrom。所以可以直接在/media/cdrom中对CD中的内容进行管理。



## vi

### 查找

当你用vi打开一个文件后，因为文件太长，如何才能找到你所要查找的关键字呢？ 
在vi里可没有菜单-〉查找。

不过没关系，你在命令模式下敲斜杆( / )这时在状态栏（也就是屏幕左下脚）就出现了 “/” 然后输入你要查找的关键字敲回车就可以了。
如果你要继续查找此关键字，敲字符 n 就可以继续查找了。
敲字符N（大写N）就会向前查询。

### vi和cat

cat 命令是linux系统下一个文本打印的命令，用于输出一个文本的信息到控制台上，该命令的输入类似于使用word打开一个文档，但是该文档不能编辑。

vi 命令是linux系统下用于文本查看、编辑的命令，不仅仅可以查看，还可以编辑。



## 路径

有/会认为是目录，没/会认为是文件。

加了/浏览器会指向一个目录，目录的话会读取默认文件index等等。没有/会先尝试读取文件，如果没有文件再找与该文件同名的目录，最后才读目录下的默认文件。

网址没有加上/会给服务器增加一个查找是否有同名文件的过程。



## 引用

[linux如何复制文件夹和移动文件夹](https://www.cnblogs.com/liaojie970/p/6746230.html)

[shell程序中 2> /dev/null 代表什么意思？ - 裕用ID的回答 - 知乎](https://www.zhihu.com/question/53295083/answer/135258024)

[Linux学习笔记（二）：什么是挂载？mount的用处在哪？ - 闻人翎悬 - CSDN](https://blog.csdn.net/qq_39521554/article/details/79501714)

[Linux 如何在 vi 里搜索关键字 - 蝈蝈俊 - CSDN](https://blog.csdn.net/ghj1976/article/details/6066069)