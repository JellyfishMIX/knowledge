# 状态驱动程序



## 概念

对于java的notifyAll 方法，我们知道 notify 可以唤醒 wait set 中的一个线程，但是如果 wait set 中存在多于一个线程时，我们并无法控制哪个线程被唤醒。假如所有线程的执行逻辑都是一样的，那么无所谓谁被唤醒，因为都是干一样的工作。

但如果是本节前面提出的问题，一个老师线程负责留作业，一个学生线程负责写作业。假如此时开启了多个学生线程，当学生写完作业后本来需要通知老师留作业，但被 notify 的并不一定的是老师线程，也可能 notify 了其他学生线程。

为了解决这个问题，我们可以使用 notifyAll 来唤醒所有在此对象的 wait set 上的线程。而获得锁的线程是否真的需要做什么工作是由自己控制的。如果学生线程先抢到 CPU 资源，但是由于作业列表为空，他又会选择 wait 进入 wait set。此时他会释放锁。而老师线程此时会获得锁，在看到作业列表为空后，则会添加新的作业。通过 wait/notifyAll 让多个线程交互，同时通过共享资源的状态，各线程控制自己的逻辑。这样的程序称之为状态驱动程序。也就是说是否真的执行逻辑，是由状态值所决定的。如果状态不满足，即使被 notify 了，也会再次进入 wait set。

![图片描述](https://image-hosting.jellyfishmix.com/20200918164735.jpg)



## 引用/参考

[ Java并发编程学习宝典 - 08 - 李一鸣 - 慕课网](https://www.imooc.com/read/49/article/940)