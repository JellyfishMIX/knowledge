# 浏览器地址栏输入 URL 到页面展示



## 浏览器地址栏输入 URL 到页面展示，这中间发生了什么？越详细越好。

整体上可分这几步：

1. 用户输入 URL 并回车。

2. 浏览器处理 URL。

   A 浏览器进程检查 URL，组装协议，构成完整的 URL。

   B 浏览器进程通过进程间通信（InterProcess Communication）把 URL 请求发送给网络进程。

   C 网络进程获取到 URL，先去本地缓存中查找是否有缓存文件，如果有，拦截请求，直接 200 返回；否则，进入网络请求过程。

3. 建立网络连接

   A 网络进程请求 DNS 返回域名对应的 IP 和端口号，如果之前 DNS 数据缓存服务缓存过当前域名信息，就会直接返回缓存信息；否则，请求将使用域名解析得到的 IP 和端口号。如果没有端口号，http 默认 80，https 默认 443。如果是 https 请求，还需要建立 TLS 连接。

   B TCP 通过三次握手同服务端建立起链接。

   - 传输层会把 http 请求加上 TCP 头部 —— 包括源端口号、目标程序端口号和用于校验数据完整性的序号，然后向下传输到网络层。

   - 网络层在数据包上加上 IP 头部 —— 包括源 IP 地址和目标 IP 地址，继续向下传输到底层。

   - 底层通过物理网络传输给目标服务器主机。

   - 目标服务器网络层接收到数据包，解析出 IP 头部，识别出数据部分，将解开的数据包向上传输到传输层。

   - E 目标服务器传输层获取到数据包，解析出 TCP 头部，识别端口，将解开的数据包向上传输到应用层。

     这其实就是 TCP/IP 链路：源应用层 —> 源传输层 —> 源网络层 —> 目标网络层 —> 目标传输层 —> 目标应用层。

4. 服务端处理数据流程。

   服务端由于规模不同架构不同，通常处理流程有一些差异。大体上可以分为：

   A 网络接入层处理请求 URL，并路由给真正的应用服务器集群。网络接入层一般是 nginx/apache 服务器，进行请求转发、负载均衡等。

   B 应用服务器处理真正的业务逻辑。通常会通过 SOA、微服务等方式调用下游的业务服务，通常还包括缓存读写逻辑等。

   C 业务逻辑最终会和数据库结合起来，在进行一系列的数据增删查改后，通过 SOA、微服务等方式返回给调用方具有业务语义的数据。

5. 浏览器解析渲染过程

   A 网络进程将获取到的数据包进行解析，根据响应头中的 Content-type 来判断响应数据的类型，如果是字节流类型，就将该请求交给下载管理器，流程结束；如果是 text/html 类型，就通知浏览器进程获取文档准备渲染。

   B 浏览器进程获取到通知，根据当前页面 B 是否是从页面 A 打开的并且和页面 A 是否是同一个站点（根域名和协议一样就被认为是同一个站点），如果满足上述条件，就复用之前网页的进程，否则，新创建一个单独的渲染进程。

   C 渲染进程对文档进行页面解析和子资源加载，HTML 通过 HTM 解析器转成 DOM Tree，CSS 按照 CSS 规则和 CSS 解释器转成 CSSOM TREE，两个 tree 结合，形成 render tree（不包含 HTML 的具体元素和元素要画的具体位置），通过 Layout 可以计算出每个元素具体的宽高颜色位置，结合起来，开始绘制，最后显示在屏幕中新页面显示出来。



##引用/参考

[高薪之路--Java面试题精选集 - jiehao - 慕课网](https://www.imooc.com/read/67#catalog)