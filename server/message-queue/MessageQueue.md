# MessageQueue



## 优点

- 可以让服务横向扩展、同一个服务部署多个，形成服务集群
- 如果某个服务挂掉了，使用HTTP通信，request直接就丢失了。但是使用MQ，可以把request保存在消息队列中，等服务恢复后订阅获取未被执行的request。

负载不大的服务使用MQ，主要是看中了2. 好处，防止服务挂了导致request丢失。



## 消息回调

**Q**：那要怎么回调呢？消息可以有去有回吗？是异步的话，前端就不知道调用的服务有没有成功了。

**A**：前端可以知道的，只不过需要前端做界面配合。

这种方式本身使用的是异步方式，主要是为了保证request一定会被执行。

比如A服务调用B服务，request进入A服务，A服务把消息0存进MQ，B服务订阅消费此消息0。A服务把消息0存进MQ后，会立刻返回给前端一个结果。然后前端可以把界面修改为“正在处理”的状态。

等到B服务恢复之后，B服务消费消息0，执行相应逻辑，执行完毕后可以通知A服务修改处理状态为“已完成”。

然后就是A服务如何通知前端处理状态变更为“已完成”的问题了。

这个模式，可以参照阿里云ECS的重启。阿里云的重启，前端就是会显示“正在重启中”，重启肯定是另一个服务处理的。ECS重启完成后，前端界面状态变更为“重启成功”。

**Q**：那要怎么通知前端呢？ajax后端不可以主动给前端发送消息。

**A**：这就是另一个话题了，这个话题是：“后端”如何给“前端”发送消息。可以再做了解，又是不少内容。

可以参考qq、微信，qq、微信就是实现了“后端”给“前端”发送消息。

“后端”如何给“前端”发送消息，如果有这个需求，肯定能实现的。比如：阿里云重启ECS，重启需要一段时间，重启中前端界面状态为“重启中”。前端在ECS重启完成后，界面状态变更为“重启成功”。

具体方法可自行检索“后端给前端发送消息”。方法比如：socket，ajax轮询等。