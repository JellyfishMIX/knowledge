## I/O



## Java 中 BIO、NIO、AIO 的区别

- 含义不同：
  - BIO（Blocking IO）是同步并阻塞的 IO，线程发起 IO 请求后，不论内核是否准备好 IO 操作，都会一直阻塞直到操作完成；
  - NIO（Non-blocking IO）是同步非阻塞的 IO，线程发起 IO 请求后立即返回；内核在做好 IO 操作的准备之后，通过调用注册的回调函数通知线程做 IO 操作，线程开始阻塞，直到操作完成；
  - AIO（Asynchronous IO）是异步非阻塞的 IO，线程发起 IO 请求，立即返回；内存做好 IO 操作的准备之后，做 IO 操作，直到操作完成或者失败，通过调用注册的回调函数通知线程做 IO 操作完成或者失败。
- 应用场景不同：
  - BIO 从 JDK1.4 之前的版本，适用于低负载、低并发、业务逻辑耗时较长的场景；
  - NIO 从 JDK1.4 开始支持，适用于高负载高并发且业务逻辑简单（轻操作）的场景，典型场景是聊天服务器；
  - AIO 从 JDK1.7 开始支持，适用于高负载高并发且业务逻辑复杂（重操作）的场景，典型场景是相册服务器。

从 Java 发展历史来看，BIO->NIO->AIO，后者的出现是为了扩展前者的应用场景。

- BIO：在服务端，通常是在 while 循环中调用 accept 方法等待接收客户端的连接请求，一旦接收到一个连接请求，就可以建立通信套接字在这个通信套接字上进行读写操作，此时不能再接收其他客户端连接请求，只能等待同当前连接的客户端的操作执行完成。 如果 BIO 要能够同时处理多个客户端请求，就必须使用多线程，即每次 accept 阻塞等待来自客户端请求，一旦受到连接请求就建立通信套接字同时开启一个新的线程来处理这个套接字的数据读写请求，然后立刻又继续 accept 等待其他客户端连接请求，即为每一个客户端连接请求都创建一个线程来单独处理；

- NIO ：与 BIO 的最大的区别是多路复用的思想，只需要开启一个线程就（或者少量多线程）可以处理来自多个客户端的 IO 事件，用来扩展 BIO 的高并发场景。

  - 若服务端监听到客户端连接请求，便为其建立通信套接字 (java 中就是通道)，然后返回继续监听，若同时有多个客户端连接请求到来也可以全部收到，依次为它们都建立通信套接字。

  - 若服务端监听到来自已经创建了通信套接字的客户端发送来的数据，就会调用对应接口处理接收到的数据，若同时有多个客户端发来数据也可以依次进行处理。

  - AIO：与 NIO 不同，当进行读写操作时，只须直接调用 API 的 read 或 write 方法即可。这两种方法均为异步的，完成后会主动调用回调函数。如果是读操作，操作系统会将可读的流传入 read 方法的缓冲区，并通知应用程序；如果是写操作，操作系统在将 write 方法传递的流写入完成后，也会通知应用程序。 在 JDK1.7 中，主要在 java.nio.channels 包下增加了下面四个异步通道来实现：

  - AsynchronousSocketChannel

  - AsynchronousServerSocketChannel

    - AsynchronousFileChannel

    - AsynchronousDatagramChannel

      这四个类的 read/write 方法，都会返回一个带回调函数的对象，当执行完读取 / 写入操作后，直接调用回调函数。



## 同步与异步，阻塞与非阻塞的区别

- 同步与异步：
  - 同步：调用线程发出同步请求后，在没有得到结果前，该调用就不会返回。前面的同步调用处理完了后才能处理下一个同步调用。
  - 异步：调用线程发出异步请求后，在没有得到结果前，该调用就返回了。真正的结果数据会在业务处理完成后以信号或者回调的形式通知调用者。
- 阻塞与非阻塞
  - 阻塞：调用线程发出请求后，在没有得到结果前，该线程就会被挂起，此时该线程处于非可执行状态。直到返回结果返回后，此线程才会被唤醒，继续运行。
  - 非阻塞：调用线程发出请求后，在没有得到结果前，该调用就返回了，整个过程该线程不会被挂起。

同步与异步、阻塞与非阻塞很容易混淆。简单地说：

- **同步 / 异步**的**关键差异**在于 **IO 操作就绪后有没有回调**，是针对**数据处理端**而言；
  - **同步** ，IO 操作是否就绪后没有回调，通常需要**业务发起端**使用**轮询方法**查看。
  - **异步** ，IO 操作是否就绪后有回调，通常会主动唤起**业务发起端**。
  - **阻塞 / 非阻塞**的**关键差异**在于 **IO 操作尚未就绪时，进程是否需要等待，**是针对**业务发起端**而言。
    - **阻塞**，IO 操作沿未就绪时，**业务发起端**的用户程序就进入等待状态，直到数据准备好或者可以读写为止。
    - **非阻塞**，IO 操作沿未就绪时，**业务发起端**的用户程序可以立刻返回无须等待。

> 举个例子，张三煮开水。场景：张三、普通水壶（下称水壶）、水开后会响的水壶（下称响水壶）。
>
> - **同步阻塞**： 张三把水壶放到火上，在旁边等水开；
> - **同步非阻塞**：张三把水壶放到火上，去客厅看电视，时不时去厨房看看水开没有；
> - **异步阻塞**：张三把响水壶放到火上，在旁边等水开。
> - **异步非阻塞**：张三把响水壶放到火上，去客厅看电视，水壶响之前不再去看它了，响了再去拿壶。
>
> 所谓**同步异步**，是针对水壶（数据处理端）而言：**普通水壶，同步**，只能让调用者（张三）去轮询水壶开没有；**响水壶，异步**，水开后自己会发信号给张三。
>
> 所谓**阻塞非阻塞**，是针对张三而言：**在旁边等待的张三，阻塞** ， 别人叫他也干不了其他事；**看电视的张三，非阻塞**，烧水的同时还可以看电视。



## 引用/参考

[高薪之路--Java面试题精选集 - jiehao - 慕课网](https://www.imooc.com/read/67#catalog)